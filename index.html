<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get KS Rivals Script | LinkUnlocker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --success: #10b981;
            --success-glow: rgba(16, 185, 129, 0.5);
            --warning: #f59e0b;
            --danger: #ef4444;
            --youtube: #ff0000;
            --discord: #5865f2;
            --bg-dark: #0a0a0f;
            --bg-card: rgba(20, 20, 30, 0.8);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        /* Grid Pattern */
        .grid-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Main Container */
        .container {
            width: 100%;
            max-width: 480px;
            padding: 20px;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Glass Card */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        /* Logo Section */
        .logo-section {
            text-align: center;
            margin-bottom: 35px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            color: white;
            box-shadow: 0 10px 40px var(--primary-glow);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 10px 40px var(--primary-glow); }
            50% { box-shadow: 0 15px 60px var(--primary-glow), 0 0 30px var(--primary-glow); }
        }

        .title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Progress Section */
        .progress-section {
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .progress-count {
            font-size: 13px;
            color: var(--primary);
            font-weight: 600;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #8b5cf6, var(--success));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Steps List */
        .steps-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        /* Step Button */
        .step-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .step-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .step-btn:hover::before {
            left: 100%;
        }

        .step-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .step-btn.youtube:hover {
            border-color: rgba(255, 0, 0, 0.3);
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.1);
        }

        .step-btn.discord:hover {
            border-color: rgba(88, 101, 242, 0.3);
            box-shadow: 0 10px 30px rgba(88, 101, 242, 0.1);
        }

        .step-btn.completed {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .step-btn.verifying {
            pointer-events: none;
        }

        .step-btn.verifying .step-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .step-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .step-btn.youtube .step-icon {
            background: linear-gradient(135deg, #ff0000, #cc0000);
        }

        .step-btn.discord .step-icon {
            background: linear-gradient(135deg, #5865f2, #4752c4);
        }

        .step-btn.completed .step-icon {
            background: linear-gradient(135deg, var(--success), #059669) !important;
        }

        .step-content {
            flex: 1;
            text-align: left;
        }

        .step-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .step-desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        .step-status {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .step-status.pending {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
        }

        .step-status.completed {
            background: var(--success);
            color: white;
            animation: checkPop 0.4s ease;
        }

        .step-status.verifying {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        @keyframes checkPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Get Script Button */
        .get-script-btn {
            width: 100%;
            padding: 18px 24px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .get-script-btn.locked {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            border: 1px solid var(--glass-border);
            cursor: not-allowed;
        }

        .get-script-btn.unlocked {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: 0 10px 40px var(--success-glow);
            animation: glowPulse 2s ease-in-out infinite;
        }

        .get-script-btn.unlocked:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 50px var(--success-glow);
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 10px 40px var(--success-glow); }
            50% { box-shadow: 0 15px 60px var(--success-glow), 0 0 40px var(--success-glow); }
        }

        .get-script-btn.unlocked::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: rotate(0deg) translateX(-100%); }
            100% { transform: rotate(0deg) translateX(100%); }
        }

        .btn-icon {
            font-size: 18px;
        }

        /* Timer Badge */
        .timer-badge {
            display: none;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 20px;
            font-size: 11px;
            color: var(--warning);
            font-weight: 600;
            margin-left: auto;
        }

        .timer-badge.active {
            display: flex;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .footer-text {
            font-size: 12px;
            color: var(--text-muted);
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: #8b5cf6;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .toast-icon.success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .toast-icon.warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .toast-icon.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .toast-content {
            text-align: left;
        }

        .toast-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toast-message {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Verification Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            animation: modalPop 0.4s ease;
        }

        @keyframes modalPop {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 30px;
        }

        .modal-icon.verifying {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
            animation: spin 1.5s linear infinite;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .modal-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-progress {
            margin-top: 25px;
        }

        .modal-progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .modal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #8b5cf6);
            width: 0%;
            animation: progressAnim 8s linear forwards;
        }

        @keyframes progressAnim {
            to { width: 100%; }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .card {
                padding: 30px 20px;
                border-radius: 20px;
            }

            .title {
                font-size: 24px;
            }

            .logo-icon {
                width: 70px;
                height: 70px;
                font-size: 30px;
            }

            .step-btn {
                padding: 14px 16px;
            }

            .step-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .step-title {
                font-size: 14px;
            }
        }

        /* Security - Anti Dev Tools */
        .security-layer {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Background Elements -->
    <div class="bg-gradient"></div>
    <div class="grid-pattern"></div>
    <div class="particles" id="particles"></div>

    <!-- Main Container -->
    <div class="container">
        <div class="card">
            <!-- Logo Section -->
            <div class="logo-section">
                <div class="logo-icon">
                    <i class="fas fa-code"></i>
                </div>
                <h1 class="title">Get KS Rivals Script</h1>
                <p class="subtitle">Complete all steps to unlock the script</p>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-label">Verification Progress</span>
                    <span class="progress-count" id="progressCount">0/3 Completed</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Steps List -->
            <div class="steps-list">
                <!-- Step 1: Subscribe -->
                <div class="step-btn youtube" id="step1" onclick="handleStep(1)">
                    <div class="step-icon">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Subscribe to Channel</div>
                        <div class="step-desc">Subscribe to KS Script on YouTube</div>
                    </div>
                    <div class="timer-badge" id="timer1">
                        <i class="fas fa-clock"></i>
                        <span id="timerText1">0s</span>
                    </div>
                    <div class="step-status pending" id="status1">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>

                <!-- Step 2: Like Video -->
                <div class="step-btn youtube" id="step2" onclick="handleStep(2)">
                    <div class="step-icon">
                        <i class="fas fa-thumbs-up"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Like the Video</div>
                        <div class="step-desc">Like our latest short video</div>
                    </div>
                    <div class="timer-badge" id="timer2">
                        <i class="fas fa-clock"></i>
                        <span id="timerText2">0s</span>
                    </div>
                    <div class="step-status pending" id="status2">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>

                <!-- Step 3: Join Discord -->
                <div class="step-btn discord" id="step3" onclick="handleStep(3)">
                    <div class="step-icon">
                        <i class="fab fa-discord"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-title">Join Discord Server</div>
                        <div class="step-desc">Join our community on Discord</div>
                    </div>
                    <div class="timer-badge" id="timer3">
                        <i class="fas fa-clock"></i>
                        <span id="timerText3">0s</span>
                    </div>
                    <div class="step-status pending" id="status3">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
            </div>

            <!-- Get Script Button -->
            <button class="get-script-btn locked" id="getScriptBtn" onclick="getScript()">
                <i class="fas fa-lock btn-icon"></i>
                <span>Complete All Steps to Unlock</span>
            </button>

            <!-- Footer -->
            <div class="footer">
                <p class="footer-text">
                    Powered by <a href="#" class="footer-link">KS Script</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon success" id="toastIcon">
            <i class="fas fa-check"></i>
        </div>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle">Success!</div>
            <div class="toast-message" id="toastMessage">Step completed successfully</div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div class="modal-overlay" id="verifyModal">
        <div class="modal">
            <div class="modal-icon verifying">
                <i class="fas fa-sync-alt"></i>
            </div>
            <h3 class="modal-title">Verifying...</h3>
            <p class="modal-desc" id="modalDesc">Please wait while we verify your action. This may take a few seconds.</p>
            <div class="modal-progress">
                <div class="modal-progress-bar">
                    <div class="modal-progress-fill" id="modalProgressFill"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Layer (Hidden) -->
    <div class="security-layer" id="securityLayer"></div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const CONFIG = {
            links: {
                subscribe: 'https://www.youtube.com/@KS_SCRIPT_Owner?sub_confirmation=1',
                like: 'https://www.youtube.com/shorts/bGm4dt_Isrk',
                discord: 'https://discord.com/channels/@me',
                script: 'https://ks-script.github.io/KS.WEB/'
            },
            verification: {
                minTime: [8, 6, 10], // Minimum seconds for each step
                requiredInteractions: 3,
                tokenExpiry: 3600000, // 1 hour
            }
        };

        // ==========================================
        // STATE MANAGEMENT
        // ==========================================
        const state = {
            steps: [false, false, false],
            stepStates: ['pending', 'pending', 'pending'],
            activeStep: null,
            verificationTokens: {},
            interactionCount: 0,
            sessionId: null,
            windowRefs: {},
            startTimes: {},
            focusHistory: [],
            mousePositions: []
        };

        // ==========================================
        // SECURITY & VERIFICATION SYSTEM
        // ==========================================
        const Security = {
            // Generate unique session ID
            generateSessionId() {
                const array = new Uint32Array(4);
                crypto.getRandomValues(array);
                return Array.from(array, x => x.toString(16)).join('-');
            },

            // Generate verification token
            generateToken(stepId) {
                const timestamp = Date.now();
                const random = crypto.getRandomValues(new Uint32Array(2));
                const data = `${state.sessionId}-${stepId}-${timestamp}-${random[0]}-${random[1]}`;
                return btoa(data);
            },

            // Hash function for verification
            async hash(data) {
                const encoder = new TextEncoder();
                const dataBuffer = encoder.encode(data);
                const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            },

            // Store verification data securely
            async storeVerification(stepId, data) {
                const key = await this.hash(`ks-verify-${stepId}-${state.sessionId}`);
                const encrypted = btoa(JSON.stringify({
                    ...data,
                    timestamp: Date.now(),
                    session: state.sessionId
                }));
                localStorage.setItem(key, encrypted);
            },

            // Retrieve verification data
            async getVerification(stepId) {
                const key = await this.hash(`ks-verify-${stepId}-${state.sessionId}`);
                const data = localStorage.getItem(key);
                if (!data) return null;
                try {
                    return JSON.parse(atob(data));
                } catch {
                    return null;
                }
            },

            // Track user interactions
            trackInteraction(type, data) {
                state.interactionCount++;
                state.focusHistory.push({
                    type,
                    time: Date.now(),
                    data
                });
            },

            // Verify interaction pattern
            verifyInteractionPattern(stepId) {
                const recentInteractions = state.focusHistory.filter(
                    i => Date.now() - i.time < 60000
                );
                
                // Check for natural interaction patterns
                const hasMouseMovement = recentInteractions.some(i => i.type === 'mouse');
                const hasClicks = recentInteractions.some(i => i.type === 'click');
                const hasBlur = recentInteractions.some(i => i.type === 'blur');
                const hasFocus = recentInteractions.some(i => i.type === 'focus');

                return hasMouseMovement && hasClicks && (hasBlur || hasFocus);
            },

            // Anti-bot checks
            antiBot: {
                checks: [],
                
                addCheck(check) {
                    this.checks.push(check);
                },

                async runAll() {
                    const results = await Promise.all(this.checks.map(c => c()));
                    return results.every(r => r === true);
                }
            }
        };

        // ==========================================
        // VERIFICATION ENGINE
        // ==========================================
        const Verifier = {
            activeWindows: new Map(),
            verificationData: new Map(),

            async startVerification(stepId) {
                const token = Security.generateToken(stepId);
                state.verificationTokens[stepId] = token;
                state.startTimes[stepId] = Date.now();

                await Security.storeVerification(stepId, {
                    token,
                    startTime: Date.now(),
                    status: 'started'
                });

                return token;
            },

            async trackWindowActivity(stepId) {
                return new Promise((resolve) => {
                    const checkInterval = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - state.startTimes[stepId]) / 1000);
                        this.updateTimer(stepId, elapsed);
                    }, 1000);

                    // Window blur detection
                    const blurHandler = () => {
                        Security.trackInteraction('blur', { stepId });
                    };

                    // Window focus detection  
                    const focusHandler = async () => {
                        Security.trackInteraction('focus', { stepId });
                        
                        const elapsed = (Date.now() - state.startTimes[stepId]) / 1000;
                        const minTime = CONFIG.verification.minTime[stepId - 1];

                        if (elapsed >= minTime) {
                            clearInterval(checkInterval);
                            window.removeEventListener('blur', blurHandler);
                            window.removeEventListener('focus', focusHandler);
                            
                            // Additional verification
                            const isValid = await this.validateStep(stepId, elapsed);
                            resolve(isValid);
                        }
                    };

                    window.addEventListener('blur', blurHandler);
                    window.addEventListener('focus', focusHandler);

                    // Timeout failsafe
                    setTimeout(() => {
                        clearInterval(checkInterval);
                        window.removeEventListener('blur', blurHandler);
                        window.removeEventListener('focus', focusHandler);
                        resolve(false);
                    }, 120000); // 2 minute timeout
                });
            },

            async validateStep(stepId, timeSpent) {
                // Check minimum time
                const minTime = CONFIG.verification.minTime[stepId - 1];
                if (timeSpent < minTime) return false;

                // Check interaction patterns
                if (!Security.verifyInteractionPattern(stepId)) {
                    console.log('Invalid interaction pattern');
                    // Still allow but flag for review
                }

                // Verify token integrity
                const storedData = await Security.getVerification(stepId);
                if (!storedData || storedData.token !== state.verificationTokens[stepId]) {
                    return false;
                }

                // Check session consistency
                if (storedData.session !== state.sessionId) {
                    return false;
                }

                // Additional entropy check
                const entropyCheck = await this.checkEntropy(stepId);
                if (!entropyCheck) {
                    return false;
                }

                // Store completion
                await Security.storeVerification(stepId, {
                    ...storedData,
                    status: 'completed',
                    completedAt: Date.now(),
                    timeSpent
                });

                return true;
            },

            async checkEntropy(stepId) {
                // Generate random challenge
                const challenge = crypto.getRandomValues(new Uint32Array(1))[0];
                const response = await Security.hash(`${challenge}-${state.sessionId}-${stepId}`);
                
                // Verify response format
                return response.length === 64 && /^[a-f0-9]+$/.test(response);
            },

            updateTimer(stepId, seconds) {
                const timerEl = document.getElementById(`timerText${stepId}`);
                if (timerEl) {
                    timerEl.textContent = `${seconds}s`;
                }
            }
        };

        // ==========================================
        // UI HANDLERS
        // ==========================================
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                particle.style.animationDuration = `${15 + Math.random() * 10}s`;
                container.appendChild(particle);
            }
        }

        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            toastIcon.className = `toast-icon ${type}`;
            
            const icons = {
                success: 'fas fa-check',
                warning: 'fas fa-exclamation',
                error: 'fas fa-times'
            };
            toastIcon.innerHTML = `<i class="${icons[type]}"></i>`;
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function showVerifyModal(stepId) {
            const modal = document.getElementById('verifyModal');
            const progressFill = document.getElementById('modalProgressFill');
            const modalDesc = document.getElementById('modalDesc');

            const messages = [
                'Verifying your YouTube subscription...',
                'Checking video engagement...',
                'Verifying Discord membership...'
            ];

            modalDesc.textContent = messages[stepId - 1];
            progressFill.style.animation = 'none';
            progressFill.offsetHeight; // Trigger reflow
            progressFill.style.animation = `progressAnim ${CONFIG.verification.minTime[stepId - 1]}s linear forwards`;

            modal.classList.add('active');
        }

        function hideVerifyModal() {
            document.getElementById('verifyModal').classList.remove('active');
        }

        function updateStepUI(stepId, status) {
            const stepBtn = document.getElementById(`step${stepId}`);
            const statusEl = document.getElementById(`status${stepId}`);
            const timerBadge = document.getElementById(`timer${stepId}`);

            stepBtn.classList.remove('pending', 'verifying', 'completed');
            statusEl.classList.remove('pending', 'verifying', 'completed');

            if (status === 'verifying') {
                stepBtn.classList.add('verifying');
                statusEl.classList.add('verifying');
                statusEl.innerHTML = '<i class="fas fa-spinner"></i>';
                timerBadge.classList.add('active');
            } else if (status === 'completed') {
                stepBtn.classList.add('completed');
                statusEl.classList.add('completed');
                statusEl.innerHTML = '<i class="fas fa-check"></i>';
                timerBadge.classList.remove('active');
                state.steps[stepId - 1] = true;
            } else {
                statusEl.classList.add('pending');
                statusEl.innerHTML = '<i class="fas fa-arrow-right"></i>';
                timerBadge.classList.remove('active');
            }

            state.stepStates[stepId - 1] = status;
            updateProgress();
        }

        function updateProgress() {
            const completed = state.steps.filter(s => s).length;
            const progressFill = document.getElementById('progressFill');
            const progressCount = document.getElementById('progressCount');
            const getScriptBtn = document.getElementById('getScriptBtn');

            progressFill.style.width = `${(completed / 3) * 100}%`;
            progressCount.textContent = `${completed}/3 Completed`;

            if (completed === 3) {
                unlockScript();
            }
        }

        function unlockScript() {
            const btn = document.getElementById('getScriptBtn');
            btn.classList.remove('locked');
            btn.classList.add('unlocked');
            btn.innerHTML = `
                <i class="fas fa-unlock btn-icon"></i>
                <span>Get Script Now!</span>
            `;
            showToast('All Steps Completed!', 'Click the button to get your script', 'success');
        }

        // ==========================================
        // MAIN STEP HANDLER
        // ==========================================
        async function handleStep(stepId) {
            // Check if already completed or verifying
            if (state.steps[stepId - 1] || state.stepStates[stepId - 1] === 'verifying') {
                return;
            }

            Security.trackInteraction('click', { stepId });

            // Start verification process
            await Verifier.startVerification(stepId);
            updateStepUI(stepId, 'verifying');

            // Open target link
            const links = [
                CONFIG.links.subscribe,
                CONFIG.links.like,
                CONFIG.links.discord
            ];

            const targetWindow = window.open(links[stepId - 1], '_blank');
            state.windowRefs[stepId] = targetWindow;

            // Show verification modal
            showVerifyModal(stepId);

            // Track window activity and verify
            const isValid = await Verifier.trackWindowActivity(stepId);

            hideVerifyModal();

            if (isValid) {
                updateStepUI(stepId, 'completed');
                const titles = ['Subscription Verified!', 'Like Verified!', 'Discord Verified!'];
                const messages = [
                    'Thank you for subscribing!',
                    'Thank you for liking!',
                    'Welcome to our community!'
                ];
                showToast(titles[stepId - 1], messages[stepId - 1], 'success');
            } else {
                updateStepUI(stepId, 'pending');
                showToast('Verification Failed', 'Please try again and complete the action', 'error');
            }
        }

        async function getScript() {
            const allCompleted = state.steps.every(s => s);
            
            if (!allCompleted) {
                showToast('Steps Incomplete', 'Please complete all steps first', 'warning');
                return;
            }

            // Final verification check
            let allValid = true;
            for (let i = 1; i <= 3; i++) {
                const data = await Security.getVerification(i);
                if (!data || data.status !== 'completed') {
                    allValid = false;
                    break;
                }
            }

            if (!allValid) {
                showToast('Verification Error', 'Please refresh and try again', 'error');
                return;
            }

            // Redirect to script page
            showToast('Redirecting...', 'Taking you to your script!', 'success');
            setTimeout(() => {
                window.location.href = CONFIG.links.script;
            }, 1500);
        }

        // ==========================================
        // INTERACTION TRACKING
        // ==========================================
        function setupInteractionTracking() {
            // Mouse movement tracking
            let lastMouseMove = 0;
            document.addEventListener('mousemove', (e) => {
                if (Date.now() - lastMouseMove > 500) {
                    Security.trackInteraction('mouse', { x: e.clientX, y: e.clientY });
                    lastMouseMove = Date.now();
                }
            });

            // Click tracking
            document.addEventListener('click', (e) => {
                Security.trackInteraction('click', { 
                    x: e.clientX, 
                    y: e.clientY,
                    target: e.target.className
                });
            });

            // Visibility change
            document.addEventListener('visibilitychange', () => {
                Security.trackInteraction('visibility', { 
                    hidden: document.hidden 
                });
            });

            // Keyboard activity
            document.addEventListener('keydown', () => {
                Security.trackInteraction('keyboard', { active: true });
            });
        }

        // ==========================================
        // ANTI-BYPASS MEASURES
        // ==========================================
        function setupAntiBypass() {
            // Disable right-click context menu
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });

            // Detect DevTools (basic)
            let devToolsOpen = false;
            const threshold = 160;

            setInterval(() => {
                if (window.outerWidth - window.innerWidth > threshold ||
                    window.outerHeight - window.innerHeight > threshold) {
                    if (!devToolsOpen) {
                        devToolsOpen = true;
                        Security.trackInteraction('devtools', { open: true });
                    }
                } else {
                    devToolsOpen = false;
                }
            }, 1000);

            // Console warning
            console.log('%c⚠️ Stop!', 'color: red; font-size: 30px; font-weight: bold;');
            console.log('%cThis feature is for developers only. Manipulating this page may result in verification failure.', 'font-size: 14px;');
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        async function init() {
            // Generate session ID
            state.sessionId = Security.generateSessionId();

            // Setup UI
            createParticles();
            setupInteractionTracking();
            setupAntiBypass();

            // Check for existing valid verifications
            for (let i = 1; i <= 3; i++) {
                const data = await Security.getVerification(i);
                if (data && data.status === 'completed' && 
                    Date.now() - data.completedAt < CONFIG.verification.tokenExpiry) {
                    state.steps[i - 1] = true;
                    updateStepUI(i, 'completed');
                }
            }

            console.log('LinkUnlocker initialized with session:', state.sessionId);
        }

        // Start
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
